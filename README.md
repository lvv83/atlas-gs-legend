# GeoServer Legend Plugin

Плагин позволяет получать JSON-описание легенды для слоёв, опубликованных на GeoServer.

## Сборка и установка плагина
* Установите Maven;
* Склонируйте репозиторий в каталог на Вашем компьютере;
* Соберите плагин при помощи команды `mvn clean verify`;
* Скопируйте файл `agiks-gs-legend-1.0.0.jar` из каталога `target` в подкаталог `${GEOSERVER_PATH}\WEB-INF\lib`, где `${GEOSERVER_PATH}` - каталог развернутого на веб-сервере GeoServer.
* Перезапустите GeoServer.

## Запрос
Выполните следующий http-запрос к Вашему экземпляру GeoServer:
**https://localhost:8080/geoserver/ows?service=AGIKS_LEGEND&request=getLegend&version=1.0.0&LAYERS=map1000000%3Aroad_l%2Ctopo200k%3Ahydrt**, где
* `service=AGIKS_LEGEND` - имя сервиса OWS (не меняется),
* `request=getLegend` - имя запроса OWS (не меняется),
* `version=1.0.0` - версия запроса (не меняется),
* `LAYERS=...` - имена опубликованных слоёв через запятую в формате *namespace1:layer1,namespace2:layer2[, ...]*

Кроме того, Вы можете указать размеры изображения при помощи параметров:
* `WIDTH=48` - ширина изображения в пикселях,
* `HEIGHT=48` - высота изображения в пикселях.

Плагин ожидает целые положительные значения от 8 до 256 пикселей. Рекомендуется указывать чётные значения.
По умолчанию ширина и высота изображения равна **24** пикселям.

Запятые и двоеточия в строке запроса экранируются последовательностями `%2C` и `%3A` соответственно.

## Ответ
Ответ сервера - JSON-массив в кодировке UTF-8, каждый элемент которого представлен JSON-объектом с описанием запрашиваемого слоя:

```
{
  "name": "map1000000:road_l",
  "title": "Автодороги, тропы, улицы",
  "items": []
}
```

* `name` - имя слоя;
* `title` - заголовок слоя;
* `items` - массив с элементами легенды.

Каждый элемент легенды представлен JSON-объектом:

```
{
  "label":"Улица магистральная и главная в городе",
  "content":"iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAJklEQVR42mP4//8/AzUxw6iBowYOCgMbgDS1MG0MHI3lUQOHoYEARqCYs+KOvbQAAAAASUVORK5CYII=",
  "contentType":"image/png",
  "width":24,
  "height":24,
  "minScale":500000,
  "maxScale":2500000
}
```

* `label` - подпись
* `сontent` - данные изображения в кодировке base64;
* `contentType` - MIME-тип изображения (поддерживается только "image/png");
* `width` - ширина изображения в пикселях;
* `height` - высота изображения в пикселях;
* `minScale` - нижняя граница масштаба отображения;
* `maxScale` - верхняя граница масштаба отображения.

Если параметры `minScale` и `maxScale` содержат отрицательное значение (**-1**), то границы отображения должны игнорироваться, а элемент отрисовываться на всех масштабах.
